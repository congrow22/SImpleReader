<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleReader</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Menu Bar -->
        <div id="menu-bar" class="menu-bar">
            <div class="menu-left">
                <div class="menu-item" data-menu="file">
                    <span class="menu-label">파일</span>
                    <div class="menu-dropdown" id="menu-file">
                        <div class="menu-dropdown-item" data-action="open">
                            <span>열기</span><span class="shortcut">Ctrl+O</span>
                        </div>
                        <div class="menu-dropdown-item" data-action="save">
                            <span>저장</span><span class="shortcut">Ctrl+S</span>
                        </div>
                        <div class="menu-separator"></div>
                        <div class="menu-dropdown-item" data-action="close">
                            <span>닫기</span><span class="shortcut">Ctrl+W</span>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-menu="edit">
                    <span class="menu-label">편집</span>
                    <div class="menu-dropdown" id="menu-edit">
                        <div class="menu-dropdown-item" data-action="undo">
                            <span>실행 취소</span><span class="shortcut">Ctrl+Z</span>
                        </div>
                        <div class="menu-dropdown-item" data-action="redo">
                            <span>다시 실행</span><span class="shortcut">Ctrl+Y</span>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-menu="tools">
                    <span class="menu-label">도구</span>
                    <div class="menu-dropdown" id="menu-tools">
                        <div class="menu-dropdown-item" data-action="find">
                            <span>찾기</span><span class="shortcut">Ctrl+F</span>
                        </div>
                        <div class="menu-dropdown-item" data-action="replace">
                            <span>바꾸기</span><span class="shortcut">Ctrl+H</span>
                        </div>
                        <div class="menu-separator"></div>
                        <div class="menu-dropdown-item" data-action="format">
                            <span>텍스트 정리</span><span class="shortcut">Ctrl+Shift+F</span>
                        </div>
                        <div class="menu-separator"></div>
                        <div class="menu-dropdown-item" data-action="toggle-line-numbers" id="menu-toggle-line-numbers">
                            <span>줄 번호 표시</span><span class="shortcut">Ctrl+L</span>
                        </div>
                    </div>
                </div>
                <div class="menu-item" data-menu="view">
                    <span class="menu-label">보기</span>
                    <div class="menu-dropdown" id="menu-view">
                        <div class="menu-dropdown-item" data-action="goto-line">
                            <span>줄 이동</span><span class="shortcut">Ctrl+G</span>
                        </div>
                        <div class="menu-dropdown-item" data-action="toggle-bookmark-panel">
                            <span>책갈피 패널</span><span class="shortcut">Ctrl+B</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu-right">
                <button class="menu-icon-btn" id="btn-open" title="열기 (Ctrl+O)">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.572-2.237-1.166C6.352 3.357 5.787 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
                    </svg>
                </button>
                <button class="menu-icon-btn" id="btn-save" title="저장 (Ctrl+S)" disabled>
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3.828a1 1 0 0 0-.293-.707l-1.828-1.828A1 1 0 0 0 12.172 1H2zm0 1h10.172L14 3.828V14H2V2zm2 9a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4v-2zm7 0H5v2h6v-2zM5 3h4v3H5V3zm1 0v2h2V3H6z"/>
                    </svg>
                </button>
                <button class="menu-icon-btn" id="btn-edit-mode" title="편집 모드 전환 (F2)">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                    </svg>
                </button>
                <button class="menu-icon-btn" id="btn-bookmark" title="책갈피 추가 (Ctrl+B)">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M3 1.5A1.5 1.5 0 0 1 4.5 0h7A1.5 1.5 0 0 1 13 1.5v13a.5.5 0 0 1-.74.439L8 12.297l-4.26 2.642A.5.5 0 0 1 3 14.5v-13zM4.5 1a.5.5 0 0 0-.5.5v11.78l3.76-2.331a.5.5 0 0 1 .48 0L12 13.28V1.5a.5.5 0 0 0-.5-.5h-7z"/>
                    </svg>
                </button>
                <button class="menu-icon-btn" id="btn-settings" title="설정">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.892 3.434-.901 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291a1.873 1.873 0 0 0-1.116-2.693l-.318-.094c-.835-.246-.835-1.428 0-1.674l.319-.094a1.873 1.873 0 0 0 1.115-2.693l-.16-.291c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.116l.094-.318z"/>
                    </svg>
                </button>
                <button class="menu-icon-btn" id="btn-help" title="도움말">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab Bar -->
        <div id="tab-bar" class="tab-bar">
            <div class="tab-list" id="tab-list"></div>

        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar Panel -->
            <div id="bookmark-panel" class="bookmark-panel">
                <div class="panel-toolbar">
                    <button class="panel-toolbar-btn" id="btn-toggle-sidebar" title="사이드바 접기">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"/>
                        </svg>
                    </button>
                </div>
                <div class="panel-tabs">
                    <button class="panel-tab active" id="panel-tab-files" title="열어본 파일 목록">파일</button>
                    <button class="panel-tab" id="panel-tab-bookmarks" title="책갈피">책갈피</button>
                </div>

                <!-- File List View -->
                <div class="panel-view" id="file-list-view">
                    <div class="file-list-header">
                        <button class="bookmark-toggle-btn" id="btn-toggle-favorites" title="즐겨찾기만 보기">&#9734; 즐겨찾기</button>
                    </div>
                    <div class="file-list" id="file-list"></div>
                </div>

                <!-- Bookmark View -->
                <div class="panel-view hidden" id="bookmark-view">
                    <div class="bookmark-header">
                        <button class="bookmark-toggle-btn" id="btn-toggle-bookmark-mode" title="모드 전환">전체</button>
                    </div>
                    <div class="bookmark-search">
                        <input type="text" id="bookmark-search-input" placeholder="책갈피 검색..." />
                    </div>
                    <div class="bookmark-list" id="bookmark-list"></div>
                </div>
            </div>

            <!-- Sidebar Reopen Button (visible when collapsed) -->
            <button class="sidebar-reopen-btn hidden" id="btn-reopen-sidebar" title="사이드바 열기">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"/>
                </svg>
            </button>

            <!-- Resize Handle -->
            <div class="resize-handle" id="sidebar-resize-handle"></div>

            <!-- Editor Area -->
            <div class="editor-wrapper">
                <!-- Search Dialog (floating, hidden by default) -->
                <div id="search-dialog" class="search-dialog hidden">
                    <div class="search-dialog-content">
                        <div class="search-row">
                            <input type="text" id="search-input" placeholder="찾기..." />
                            <label class="search-option" title="대소문자 구분">
                                <input type="checkbox" id="search-case-sensitive" />
                                <span>Aa</span>
                            </label>
                            <span class="search-count" id="search-count">결과 없음</span>
                            <button class="search-nav-btn" id="btn-search-prev" title="이전">&uarr;</button>
                            <button class="search-nav-btn" id="btn-search-next" title="다음">&darr;</button>
                            <button class="search-close-btn" id="btn-search-close" title="닫기">&times;</button>
                        </div>
                        <div class="replace-row hidden" id="replace-row">
                            <input type="text" id="replace-input" placeholder="바꾸기..." />
                            <button class="replace-btn" id="btn-replace" title="바꾸기">바꾸기</button>
                            <button class="replace-btn" id="btn-replace-all" title="모두 바꾸기">모두</button>
                        </div>
                    </div>
                </div>

                <!-- Editor Container (Text files) -->
                <div id="editor-container" class="editor-container">
                    <div class="editor-welcome" id="editor-welcome">
                        <div class="welcome-content">
                            <h2>SimpleReader</h2>
                            <p>대용량 텍스트 파일 뷰어</p>
                            <div class="welcome-actions">
                                <button class="welcome-btn" id="btn-welcome-open">파일 열기 (Ctrl+O)</button>
                            </div>
                            <p class="welcome-hint">파일을 드래그 앤 드롭하여 열 수도 있습니다</p>
                        </div>
                    </div>
                    <div class="editor-scroll-area hidden" id="editor-scroll-area">
                        <div class="editor-spacer-top" id="editor-spacer-top"></div>
                        <div class="editor-lines" id="editor-lines"></div>
                        <div class="editor-spacer-bottom" id="editor-spacer-bottom"></div>
                    </div>
                </div>

                <!-- EPUB Viewer Container -->
                <div id="epub-viewer-container" class="epub-viewer-container hidden">
                    <div class="epub-nav-bar" id="epub-nav-bar">
                        <button class="epub-nav-btn" id="epub-btn-prev" title="이전 챕터" disabled>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>
                        </button>
                        <select class="epub-chapter-select" id="epub-chapter-select" title="챕터 선택"></select>
                        <span class="epub-chapter-label" id="epub-chapter-label">0 / 0</span>
                        <button class="epub-nav-btn" id="epub-btn-next" title="다음 챕터" disabled>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="epub-content" id="epub-content" tabindex="0"></div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar" class="status-bar">
            <div class="status-left">
                <span class="status-item" id="status-line">줄: 0 / 0</span>
                <span class="status-separator">|</span>
                <span class="status-item" id="status-chars">문자: 0</span>
            </div>
            <div class="status-right">
                <span class="status-item" id="status-mode">뷰어</span>
                <span class="status-separator">|</span>
                <span class="status-item" id="status-encoding">UTF-8</span>
                <span class="status-separator">|</span>
                <span class="status-item" id="status-modified"></span>
            </div>
        </div>
    </div>

    <!-- Settings Dialog Modal -->
    <div id="settings-dialog" class="modal-overlay hidden">
        <div class="modal-dialog settings-modal">
            <div class="modal-header">
                <h3>설정</h3>
                <button class="modal-close-btn" id="btn-settings-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label class="setting-label">글꼴</label>
                    <select id="setting-font-family" class="setting-input">
                        <option value="monospace">로딩 중...</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">글꼴 크기: <span id="setting-font-size-value">16</span>px</label>
                    <input type="range" id="setting-font-size" class="setting-range" min="12" max="100" value="16" />
                </div>
                <div class="setting-group">
                    <label class="setting-label">테마</label>
                    <select id="setting-theme" class="setting-input">
                        <option value="dark">다크</option>
                        <option value="sepia">세피아</option>
                        <option value="light">라이트</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-font-bold" /> 글꼴 굵게 (Bold)
                    </label>
                </div>
                <div class="setting-group">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-word-wrap" /> 자동 줄 바꿈 (Word Wrap)
                    </label>
                </div>
                <hr style="border: none; border-top: 1px solid var(--border-color); margin: 8px 0;" />
                <div class="setting-group">
                    <label class="setting-label">
                        <input type="checkbox" id="setting-context-menu" /> 우클릭 메뉴에 "Open with SimpleReader" 등록
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="btn-settings-cancel">취소</button>
                <button class="modal-btn modal-btn-primary" id="btn-settings-apply">적용</button>
            </div>
        </div>
    </div>

    <!-- Go To Line Dialog Modal -->
    <div id="goto-dialog" class="modal-overlay hidden">
        <div class="modal-dialog goto-modal">
            <div class="modal-header">
                <h3>줄 이동</h3>
                <button class="modal-close-btn" id="btn-goto-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="goto-info" id="goto-info">현재 줄: 0 / 전체: 0</p>
                <input type="number" id="goto-input" class="goto-input" placeholder="줄 번호 입력..." min="1" />
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="btn-goto-cancel">취소</button>
                <button class="modal-btn modal-btn-primary" id="btn-goto-go">이동</button>
            </div>
        </div>
    </div>

    <!-- Format Dialog Modal -->
    <div id="format-dialog" class="modal-overlay hidden">
        <div class="modal-dialog format-modal">
            <div class="modal-header">
                <h3>텍스트 정리</h3>
                <button class="modal-close-btn" id="btn-format-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="format-options">
                    <button class="format-option-btn" data-format="sentence_breaks">
                        <span class="format-option-title">문장 끝 줄바꿈</span>
                        <span class="format-option-desc">문장이 끝나는 지점에서 줄바꿈을 추가합니다</span>
                    </button>
                    <button class="format-option-btn" data-format="compress_blank_lines">
                        <span class="format-option-title">빈 줄 압축</span>
                        <span class="format-option-desc">연속된 빈 줄을 하나로 압축합니다</span>
                    </button>
                    <button class="format-option-btn" data-format="remove_blank_lines">
                        <span class="format-option-title">빈 줄 제거</span>
                        <span class="format-option-desc">모든 빈 줄을 제거합니다</span>
                    </button>
                </div>
                <div class="format-preview hidden" id="format-preview">
                    <h4>미리보기</h4>
                    <div class="format-preview-content" id="format-preview-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="btn-format-cancel">취소</button>
                <button class="modal-btn modal-btn-primary hidden" id="btn-format-apply">적용</button>
            </div>
        </div>
    </div>

    <!-- Bookmark Add Dialog -->
    <div id="bookmark-add-dialog" class="modal-overlay hidden">
        <div class="modal-dialog bookmark-add-modal">
            <div class="modal-header">
                <h3>책갈피 추가</h3>
                <button class="modal-close-btn" id="btn-bookmark-add-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="bookmark-add-info" id="bookmark-add-info">줄: 0</p>
                <input type="text" id="bookmark-memo-input" class="goto-input" placeholder="메모 입력..." />
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="btn-bookmark-add-cancel">취소</button>
                <button class="modal-btn modal-btn-primary" id="btn-bookmark-add-confirm">추가</button>
            </div>
        </div>
    </div>

    <!-- File Delete Confirm Dialog -->
    <div id="file-delete-dialog" class="modal-overlay hidden">
        <div class="modal-dialog bookmark-add-modal">
            <div class="modal-header">
                <h3>파일 삭제</h3>
                <button class="modal-close-btn" id="btn-file-delete-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="file-delete-name" id="file-delete-name"></p>
                <p class="file-delete-warning">이 파일의 모든 책갈피와 읽기 기록이 함께 삭제됩니다.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="btn-file-delete-cancel">취소</button>
                <button class="modal-btn modal-btn-danger" id="btn-file-delete-confirm">삭제</button>
            </div>
        </div>
    </div>

    <!-- Drop Overlay -->
    <div id="drop-overlay" class="drop-overlay hidden">
        <div class="drop-message">파일을 놓으세요</div>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>
